#!/bin/bash
# Pre-push hook to ensure Black formatting compliance
# Install: cp hooks/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push

# Git LFS hook (if LFS is configured)
if command -v git-lfs >/dev/null 2>&1; then
    git lfs pre-push "$@"
fi

# Black formatting check
echo ""
echo "Running Black formatting check..."

# Run Black in check mode
if ! black --check src/ tests/ 2>&1 | grep -q "would reformat"; then
    echo "✅ Black formatting: All files properly formatted"
    exit 0
fi

echo ""
echo "⚠️  Some files need Black formatting!"
echo ""
echo "Do you want to:"
echo "  1) Auto-format and continue push (you'll need to commit again)"
echo "  2) Auto-format and abort push (recommended - lets you review changes)"
echo "  3) Abort push without formatting"
echo ""
read -p "Choice (1/2/3): " choice

case $choice in
    1)
        echo "Formatting files..."
        black src/ tests/
        echo ""
        echo "✅ Files formatted! However, you need to commit these changes."
        echo "Your push will continue, but the formatted files are uncommitted."
        exit 0
        ;;
    2)
        echo "Formatting files..."
        black src/ tests/
        echo ""
        echo "✅ Files formatted! Please review, commit, and push again."
        exit 1
        ;;
    3)
        echo "❌ Push aborted. Please format your code with 'black src/ tests/' before pushing."
        exit 1
        ;;
    *)
        echo "Invalid choice. Aborting push."
        exit 1
        ;;
esac
