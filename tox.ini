# Tox configuration for testing django-trim across multiple Django versions
#
# Based on Django versions from https://pypi.org/project/Django/ (Dec 2025)
# Testing strategy: Major versions + key mid-releases
#
# Usage:
#   tox                      # Run all environments
#   tox -e py310-dj42        # Run specific environment
#   tox -e py311-dj52        # Test Django 5.2 with Python 3.11
#   tox -l                   # List all environments

[tox]
envlist =
    # Django 4.2 LTS (Long Term Support - stable, widely used)
    {py38,py39,py310,py311,py312,py313}-dj42
    # Django 5.0 (Major version)
    {py310,py311,py312,py313}-dj50
    # Django 5.1 (Stable version)
    {py310,py311,py312,py313}-dj51
    # Django 5.2 (Current stable)
    {py310,py311,py312,py313}-dj52
    coverage
    lint

isolated_build = True
skip_missing_interpreters = True

[gh-actions]
# GitHub Actions automatic Python version mapping
python =
    3.8: py38-dj42
    3.9: py39-dj42
    3.10: py310-dj42, py310-dj50, py310-dj51, py310-dj52
    3.11: py311-dj42, py311-dj50, py311-dj51, py311-dj52
    3.12: py312-dj42, py312-dj50, py312-dj51, py312-dj52
    3.13: py313-dj42, py313-dj50, py313-dj51, py313-dj52

[testenv]
passenv = *
deps =
    # Django versions - using version ranges for flexibility
    # Compatible with actual PyPI releases as of Dec 2025
    dj42: Django>=4.2,<4.3     # LTS - Latest is 4.2.27 (Apr 2026 support)
    dj50: Django>=5.0,<5.1     # Stable - Latest is 5.0.14
    dj51: Django>=5.1,<5.2     # Stable - Latest is 5.1.15
    dj52: Django>=5.2,<5.3     # Current - Latest is 5.2.9
    # Test dependencies
    pytest>=7.0.0
    pytest-django>=4.5.0
    pytest-cov>=4.0.0
    pytest-xdist>=3.0.0
    coverage[toml]>=7.0.0
    loguru

setenv =
    PYTHONPATH = {toxinidir}/src:{toxinidir}
    DJANGO_SETTINGS_MODULE = tests.settings

commands =
    pytest {posargs:tests/} -v --cov=trim --cov-report=term-missing

[testenv:coverage]
description = Generate coverage report combining all test runs
deps =
    coverage[toml]>=7.0.0

skip_install = True
commands =
    coverage combine
    coverage report
    coverage html
    coverage xml

[testenv:lint]
description = Run code quality checks
deps =
    flake8>=6.0.0
    flake8-docstrings>=1.7.0
    black>=23.0.0
    isort>=5.12.0

commands =
    flake8 src/trim tests
    black --check src/trim tests
    isort --check-only src/trim tests

[testenv:format]
description = Auto-format code
deps =
    black>=23.0.0
    isort>=5.12.0

commands =
    black src/trim tests
    isort src/trim tests

[pytest]
testpaths = tests
python_files = test_*.py *_test.py
addopts = -v --strict-markers

[coverage:run]
source = src/trim
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */migrations/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

[flake8]
max-line-length = 100
exclude =
    .git,
    __pycache__,
    .tox,
    .venv,
    build,
    dist,
    *.egg-info,
    migrations
ignore =
    E203,
    E265,
    E266,
    E402,
    E501,
    E711,
    E731,
    W391,
    W503,
    F401,
    F403,
    F405,
    F541,
    F601,
    F811,
    F821,
    F823,
    F841,
    D100,
    D104,
